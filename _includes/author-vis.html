<style>
  .link {
    stroke: #999;
    opacity: 0.6;
  }

  .node circle {
    stroke: #fff;
    opacity: 0.5;
    stroke-width: 1.5px;
  }

  .node circle:hover{opacity:.9;}

  .d3-tip {
    line-height: 1;
    color: black;
    font-size: 12px;
    max-width: 100px;
    background-color:rgb(255,255,255,.9);
    padding: 4px;
  }
  #canvas {
    width: 100%;
    display: inline-block;
    vertical-align: top;
    position: relative;
    border: 1px grey solid;
    margin: 0;
  }
</style>

<svg id="canvas"></svg>

<script src="https://d3js.org/d3.v3.js"></script>
<script type='text/javascript' src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script>

  var links = [{
    "source": "1",
    "target": "warman-manny-1983"
  }, {
    "source": "2",
    "target": "beals-a-tennyson"
  }, {
    "source": "3",
    "target": "warman-manny-1983"
  }, {
    "source": "5",
    "target": "warman-manny-1983"
  }, {
    "source": "6",
    "target": "alumni-federation-of-columbia-university"
  }, {
    "source": "7",
    "target": "kozinn-allan-new-york-times"
  }, {
    "source": "9",
    "target": "geo-p-hall-son"
  }, {
    "source": "10",
    "target": "beals-a-tennyson"
  }, {
    "source": "14",
    "target": "ballou-hubbard-w"
  }, {
    "source": "15",
    "target": "warman-manny-1983"
  }, {
    "source": "17",
    "target": "beals-a-tennyson"
  }, {
    "source": "19",
    "target": "janovsky-seymour"
  }, {
    "source": "20",
    "target": "beals-a-tennyson"
  }, {
    "source": "21",
    "target": "boldtman-j"
  }, {
    "source": "22",
    "target": "warman-manny-1983"
  }, {
    "source": "23",
    "target": "wurts-bros-new-york-n-y"
  }, {
    "source": "24",
    "target": "sprague"
  }, {
    "source": "25",
    "target": "bubley-esther"
  }, {
    "source": "27",
    "target": "bubley-esther"
  }, {
    "source": "28",
    "target": "look-magazine"
  }, {
    "source": "29",
    "target": "boldtman-j"
  }, {
    "source": "30",
    "target": "beals-a-tennyson"
  }, {
    "source": "33",
    "target": "beals-a-tennyson"
  }, {
    "source": "35",
    "target": "warman-manny-1983"
  }, {
    "source": "36",
    "target": "beals-a-tennyson"
  }, {
    "source": "37",
    "target": "beals-a-tennyson"
  }, {
    "source": "38",
    "target": "beals-a-tennyson"
  }, {
    "source": "40",
    "target": "gottscho-samuel-h-samuel-herman-1875-1971"
  }, {
    "source": "42",
    "target": "wurts-bros-new-york-n-y"
  }, {
    "source": "43",
    "target": "wurts-bros-new-york-n-y"
  }, {
    "source": "44",
    "target": "beals-a-tennyson"
  }, {
    "source": "45",
    "target": "warman-manny-1983"
  }, {
    "source": "46",
    "target": "beals-a-tennyson"
  }, {
    "source": "47",
    "target": "beals-a-tennyson"
  }, {
    "source": "48",
    "target": "beals-a-tennyson"
  }, {
    "source": "51",
    "target": "beals-a-tennyson"
  }, {
    "source": "52",
    "target": "beals-a-tennyson"
  }, {
    "source": "53",
    "target": "associated-press"
  }, {
    "source": "54",
    "target": "beals-a-tennyson"
  }, {
    "source": "56",
    "target": "beals-a-tennyson"
  }, {
    "source": "57",
    "target": "rothschild-albert"
  }, {
    "source": "59",
    "target": "rothschild-albert"
  }, {
    "source": "60",
    "target": "bubley-esther"
  }, {
    "source": "61",
    "target": "pach-brothers-firm"
  }, {
    "source": "64",
    "target": "beals-a-tennyson"
  }, {
    "source": "65",
    "target": "beals-a-tennyson"
  }, {
    "source": "66",
    "target": "beals-a-tennyson"
  }, {
    "source": "67",
    "target": "hartmann-erich-1922-july-29-magnum-photos"
  }, {
    "source": "68",
    "target": "bubley-esther"
  }, {
    "source": "69",
    "target": "warman-manny-1983"
  }, {
    "source": "70",
    "target": "beals-a-tennyson"
  }, {
    "source": "71",
    "target": "wurts-bros-new-york-n-y"
  }, {
    "source": "72",
    "target": "beals-a-tennyson"
  }, {
    "source": "74",
    "target": "beals-a-tennyson"
  }, {
    "source": "76",
    "target": "sprague"
  }, {
    "source": "77",
    "target": "beals-a-tennyson"
  }, {
    "source": "79",
    "target": "beals-a-tennyson"
  }, {
    "source": "80",
    "target": "warman-manny-1983"
  }, {
    "source": "81",
    "target": "warman-manny-1983"
  }, {
    "source": "82",
    "target": "beals-a-tennyson"
  }, {
    "source": "86",
    "target": "wurts-bros-new-york-n-y"
  }, {
    "source": "87",
    "target": "ballou-hubbard-w"
  }, {
    "source": "88",
    "target": "beals-a-tennyson"
  }, {
    "source": "89",
    "target": "wurts-bros-new-york-n-y"
  }, {
    "source": "90",
    "target": "beals-a-tennyson"
  }, {
    "source": "91",
    "target": "bogert-w-l"
  }, {
    "source": "92",
    "target": "beals-a-tennyson"
  }, {
    "source": "93",
    "target": "warman-manny-1983"
  }, {
    "source": "95",
    "target": "beals-a-tennyson"
  }, {
    "source": "96",
    "target": "hopp-morris-j"
  }, {
    "source": "97",
    "target": "beals-a-tennyson"
  }, {
    "source": "99",
    "target": "beals-a-tennyson"
  }, {
    "source": "100",
    "target": "warman-manny-1983"
  }]

var nodes = {};

function slugify(text) {
  return text.toString().toLowerCase()
    .replace(/\s+/g, '-')           // Replace spaces with -
    .replace(/[^\w\-]+/g, '')       // Remove all non-word chars
    .replace(/\-\-+/g, '-')         // Replace multiple - with single -
    .replace(/^-+/, '')             // Trim - from start of text
    .replace(/-+$/, '');            // Trim - from end of text
}

// Compute the distinct nodes from the links.
links.forEach(function(link) {
  link.source = nodes[link.source] || (nodes[link.source] = {
    name: link.source,
    url: "{{ site.baseurl }}/photos/" + slugify(link.source) + "/",
    is_tag: false
  });
  link.target = nodes[link.target] || (nodes[link.target] = {
    name: link.target,
    url: '#',
    is_tag: true
  });
});

var svg = d3.select("#canvas")
  .attr("width", 800)
  .attr("height", 600);


var force = d3.layout.force()
  .nodes(d3.values(nodes))
  .links(links)
  .size([800, 600])
  .linkDistance(40)
  .charge(-50)
  .gravity(0.05)
  .on("tick", tick)
  .start();

//---Insert------
//Set up tooltip
var tip = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-5, 0])
    .html(function (d) {
      if (d.is_tag){
        return "<b>Author: </b>" + d.name + "</span>";
      }
      else {
        return "<b>Item: </b>" + d.name + "</span>";
      }
    })
svg.call(tip);
//---End Insert---

var link = svg.selectAll(".link")
  .data(force.links())
  .enter().append("line")
  .attr("class", "link");

var node = svg.selectAll(".node")
  .data(force.nodes())
  .enter().append("g")
  .attr("class", "node")
  .on('mouseover', tip.show) //Added
  .on('mouseout', tip.hide)
  .on("dblclick", dblclick)
  .call(force.drag);


node.append("circle")
  .attr("r", function(d) {
    if (d.is_tag) {
      return 10;
    } else {
      return 8;
    }
  })
  .style("fill", function(d) {
    if (d.is_tag) {
      return "blue";
    } else {
      return "grey";
    }
  })

function tick() {
  link.attr("x1", function(d) {
      return d.source.x;
    })
    .attr("y1", function(d) {
      return d.source.y;
    })
    .attr("x2", function(d) {
      return d.target.x;
    })
    .attr("y2", function(d) {
      return d.target.y;
    });

  node.attr("transform", function(d) {
    return "translate(" + d.x + "," + d.y + ")";
  });
}

function dblclick(d){
  location.href = d.url;
}

</script>
